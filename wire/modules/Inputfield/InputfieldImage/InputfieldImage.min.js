function InputfieldImage(x){var l=null;var c={file:"",item:null,edit:null};var J={type:"image",closeOnContentClick:true,closeBtnInside:true};var d=null;var s=[];function u(){var Q=window.File&&window.FileList&&window.FileReader;var P=x(".InputfieldAllowAjaxUpload").length>0;var R=x("#PageIDIndicator").length>0;return(Q&&(R||P))}function B(R,P,Q){P||(P=250);var S,T;return function(){var W=Q||this;var V=+new Date(),U=arguments;if(S&&V<S+P){clearTimeout(T);T=setTimeout(function(){S=V;R.apply(W,U)},P)}else{S=V;R.apply(W,U)}}}function g(Q,P){return !P}function F(Q){if(Q.hasClass("ui-sortable")){Q.sortable("destroy");Q.children("li").each(function(T){var S=x(this).find("input.InputfieldFileSort");S.val(T)})}var R;var P={items:"> .gridImage",start:function(U,T){var S=I(Q.closest(".Inputfield"),"size");T.placeholder.append(x("<div/>").css({display:"block",height:S+"px",width:S+"px"}));R=window.setTimeout(function(){K(Q,null)},100);Q.addClass("InputfieldImageSorting")},stop:function(U,S){var T=x(this);if(R!==null){S.item.find(".InputfieldImageEdit__edit").click();clearTimeout(R)}T.children("li").each(function(W){var V=x(this).find(".InputfieldFileSort");if(V.val()!=W){V.val(W).change()}});Q.removeClass("InputfieldImageSorting")},cancel:".InputfieldImageEdit,.focusArea,input,textarea,button,select,option"};Q.sortable(P)}function q(Q){var P=x.extend(true,{},J);P.callbacks={elementParse:function(R){var S=x(R.el).attr("data-original");if(typeof S=="undefined"||!S){S=x(R.el).attr("src")}R.src=S}};P.gallery={enabled:true};Q.find("img").magnificPopup(P)}function v(Q){var P=x.extend(true,{},J);P.callbacks={elementParse:function(R){R.src=x(R.el).attr("src")}};P.gallery={enabled:false};Q.find("img").magnificPopup(P)}function G(P){return P.find(".InputfieldImageEdit--active")}function w(P){return x("#"+P.find(".InputfieldImageEdit__edit").attr("data-current"))}function H(R){var P=R.is(":checked");var Q=R.parents(".gridImages").find(".gridImage__deletebox");if(P){Q.prop("checked","checked").change()}else{Q.removeAttr("checked").change()}}function N(Q){if(typeof Q=="undefined"){var P=x(".gridImages")}else{var P=Q.find(".gridImages")}P.each(function(){var R=x(this),S=G(R);if(S.length){j(w(S),S)}})}function y(P){var S=[];var X=[];var U=[];var R=0,W=0,Q=0;var V;if(typeof P=="undefined"){V=x(".InputfieldImage.Inputfield")}else{V=P}V.removeClass("InputfieldImageNarrow InputfieldImageMedium InputfieldImageWide");V.each(function(){var Z=x(this);var aa=Z.width();if(aa<1){return}if(aa<=500){S[R]=Z;R++}else{if(aa<=900){X[W]=Z;W++}else{U[Q]=Z;Q++}}});for(var T=0;T<R;T++){var Y=S[T];Y.addClass("InputfieldImageNarrow")}for(var T=0;T<W;T++){var Y=X[T];Y.addClass("InputfieldImageMedium")}for(var T=0;T<Q;T++){var Y=U[T];Y.addClass("InputfieldImageWide")}}function h(){x(".focusArea.focusActive").each(function(){var P=x(this).closest(".InputfieldImageEdit, .gridImage");if(P.length){D(P)}});N();y()}function p(P){if(P.is(":checked")){P.parents(".ImageOuter").addClass("gridImage--delete")}else{P.parents(".ImageOuter").removeClass("gridImage--delete")}}function e(S,P){if(S.closest(".InputfieldImageEditAll").length){return}var R=P.find(".InputfieldImageEdit__image");var U=S.find("img");R.attr({src:U.attr("data-original"),"data-original":U.attr("data-original"),alt:U.attr("alt")});var Q=x.extend(true,{},J);Q.callbacks={elementParse:function(V){V.src=x(V.el).attr("data-original")}};Q.gallery={enabled:true};P.attr("id","edit-"+S.attr("id"));var T=P.parents(".gridImages").find(".gridImage").not(S).find("img").add(R).magnificPopup(Q);P.find(".InputfieldImageEdit__edit").attr("data-current",S.attr("id")).append(S.find(".ImageData").children().not(".InputfieldFileSort"))}function t(ak){var X,am,ab,T,aj,Z,ai,ag=null,ac,ad,al,W,R=0,ah=false;ai=ak.closest(".Inputfield");ac=I(ai,"size");ad=I(ai,"mode");if(ai.hasClass("InputfieldImageFocusZoom")){ah=true}if(ak.hasClass("gridImage")){am=ak;X=ak.find(".gridImage__overflow").find("img");ab=X}else{am=x("#"+ak.attr("data-for"));X=ak.find(".InputfieldImageEdit__image");ab=am.find(".gridImage__overflow").find("img")}function S(ao){if(typeof ao=="undefined"){if(ag!==null){return ag}var aq=ak.find(".InputfieldImageFocus");var ao=aq.val()}var an=ao.split(" ");var ap={top:(typeof an[0]=="undefined"?50:parseFloat(an[0])),left:(typeof an[1]=="undefined"?50:parseFloat(an[1])),zoom:(typeof an[2]=="undefined"?0:parseInt(an[2]))};ag=ap;return ap}function U(an){if(typeof an=="undefined"){an=S()}return an.top+" "+an.left+" "+an.zoom}function V(ao){var an=S();return an[ao]}function Q(an){ag=an;var ao=an.top+" "+an.left+" "+an.zoom;ab.attr("data-focus",ao);T=ak.find(".InputfieldImageFocus");if(ao!=T.val()){T.val(ao).trigger("change")}}function aa(ap,ao){var an=S();an[ap]=ao;Q(an)}function ae(){var aq=S();var ao=Z.parent();var ap=ao.width();var ar=ao.height();var an=Math.round(((aq.left/100)*ap)-(Z.width()/2));var at=Math.round(((aq.top/100)*ar)-(Z.height()/2));if(an<0){an=0}if(at<0){at=0}Z.css({top:at+"px",left:an+"px"})}aj=X.siblings(".focusArea");if(!aj.length){aj=x("<div />").addClass("focusArea");X.after(aj)}aj.css({height:X.height()+"px",width:X.width()+"px"}).addClass("focusActive");Z=aj.find(".focusCircle");if(!Z.length){Z=x("<div />").addClass("focusCircle");aj.append(Z)}X.parent().addClass("focusWrap");ae();var af=function(ar){var av,au,ax,at,ao,ap,aw,an;if(typeof ar=="undefined"){ar=R}R=ar;aw=aj.width();an=aj.height();if(aw>an){W.height((100-ar)+"%");av=W.height();W.width(av)}else{W.width((100-ar)+"%");av=W.width();W.height(av)}ax=S();var aq=b(ax.left,ax.top,ar,aw,an,av,av);W.css({top:aq.top+"px",left:aq.left+"px"});ax.zoom=aq.zoom;aa("zoom",aq.zoom);if(ad=="grid"){i(ab.parent(),ac,false,ax)}};var Y=function(ao,au){var at=x(this);var an=at.outerHeight();var av=at.parent().width();var ar=at.parent().height();var aw=au.position.top>0?au.position.top+(an/2):0;var aq=au.position.left>0?au.position.left+(an/2):0;var ap={top:aw>0?((aw/ar)*100):0,left:aq>0?((aq/av)*100):0,zoom:V("zoom")};Q(ap);if(ah){af(ap.zoom)}else{if(ad=="grid"){i(ab.parent(),ac,false,ap)}}};Z.draggable({containment:"parent",drag:Y,stop:Y});if(ah){var P=V("zoom");al=x("<div />").addClass("focusZoomSlider").css({"margin-top":"5px"});W=x("<div />").addClass("focusZoomBox").css({position:"absolute",background:"rgba(0,0,0,0.5)"});aj.prepend(W);X.after(al);ab.attr("src",X.attr("src"));al.slider({min:0,max:50,value:P,range:"max",slide:function(an,ao){af(ao.value)}});af(P)}else{aj.css("background-color","rgba(0,0,0,0.5)")}}function D(P){$focusCircle=P.find(".focusCircle");if($focusCircle.length){var Q=$focusCircle.closest(".focusWrap");Q.find(".focusZoomSlider").slider("destroy").remove();Q.find(".focusZoomBox").remove();Q.removeClass("focusWrap");$focusCircle.draggable("destroy");$focusCircle.parent().removeClass("focusActive");$focusCircle.remove();var R=P.find(".InputfieldImageButtonFocus");if(R.length){$icon=R.find("i");$icon.removeClass("focusIconActive").toggleClass($icon.attr("data-toggle"))}}}function z(R,Q,W){R=parseInt(R);var U=100;var V=(W/Q*100);var T=U-V;var S=R+(V/2);var P=0;if(S>=100){P=Q-W}else{if(S<=Math.floor(T/2)){P=0}else{P=Math.ceil((Q-W)/100*R)}}return P}function b(T,Z,af,ad,ac,U,R){var ae=U/R;var V=U/ad*100;var S=R/ac*100;if(V>=S){var Q=ad;var ab=ad/ae}else{var ab=ac;var Q=ac*ae}var P=Q-(Q*af/100);var Y=ab-(ab*af/100);var aa=true;if(!aa){if(P<U){P=U;Y=U/ae}if(Y<R){Y=R;P=R*ae}}var X=z(T,ad,P);var W=z(Z,ac,Y);return{left:X,top:W,width:P,height:Y,zoom:af}}function n(P){D(P);P.off("click",".InputfieldImageButtonFocus");$inputArea=P.find(".InputfieldImageEdit__edit");if($inputArea.children().not(".InputfieldFileSort").length){var Q=$inputArea.children();x("#"+$inputArea.attr("data-current")).find(".ImageData").append(Q)}}function K(R,Q){var P;if(R){P=R.find(".InputfieldImageEdit--active")}else{if(Q){P=x(".InputfieldImageEdit--active").not(Q.find(".InputfieldImageEdit--active"))}else{P=x(".InputfieldImageEdit--active")}}if(P.length){n(P);P.removeClass("InputfieldImageEdit--active").removeAttr("id");x("#"+P.attr("data-for")).removeClass("gridImageEditing")}x(".InputfieldImageEdit__replace").removeClass("InputfieldImageEdit__replace")}function j(S,Q){if(!S||!S.length){return}var P=S.parent().children().not(".InputfieldImageEdit");var T=0;var U=false;var V=null;P.each(function(){if(V){return}var W=x(this);var X=W.offset().top;if(U&&X!=T){V=W}else{if(W.attr("id")==S.attr("id")){U=true}}T=X});if(V){Q.insertBefore(V)}else{Q.insertAfter(P.eq(P.length-1))}var R=Q.find(".InputfieldImageEdit__arrow");if(R.length){R.css("left",S.position().left+(S.outerWidth()/2)+"px")}}function A(){x(window).resize(B(h,200));x(document).on("click dblclick",".gridImage__trash",function(P){var Q=x(this).find("input");Q.prop("checked",g).change();if(P.type=="dblclick"){H(Q);P.preventDefault();P.stopPropagation()}});x(document).on("change",".gridImage__deletebox",function(){p(x(this))});x(document).on("click",".gridImage__edit",function(S){var Q=x(this).closest(".gridImage");if(!Q.length){return}if(Q.closest(".InputfieldImageEditAll").length){return false}var R=Q.closest(".gridImages");var P=R.find(".InputfieldImageEdit");if(Q.hasClass("gridImageEditing")){P.find(".InputfieldImageEdit__close").click()}else{j(Q,P);n(P);e(Q,P);P.addClass("InputfieldImageEdit--active").attr("data-for",Q.attr("id"));R.find(".gridImageEditing").removeClass("gridImageEditing");Q.addClass("gridImageEditing")}}).on("click",".InputfieldImageEditAll img",function(R){R.stopPropagation();R.preventDefault();x.magnificPopup.close();var P=x.extend(true,{},J);var Q=x(this);P.items={src:Q.attr("data-original"),title:Q.attr("alt")};x.magnificPopup.open(P);return true}).on("click",".InputfieldImageButtonFocus",function(){var S=x(this);var P=S.find("i");var Q=S.closest(".InputfieldImageEdit, .gridImage");var R=Q.find(".focusCircle");if(R.length){D(Q)}else{t(Q);P.addClass("focusIconActive");P.toggleClass(P.attr("data-toggle"))}});x(document).on("click",function(Q){var P=x(Q.target);if(P.closest(".InputfieldImageEdit").length){K(null,P.parents(".gridImages"))}else{if(P.is("input, textarea")&&P.closest(".InputfieldImageEditAll").length){P.focus().one("blur",function(){P.closest(".gridImages").sortable("enable")});P.closest(".gridImages").sortable("disable")}else{if(P.closest(".gridImage__inner").length){K(null,P.parents(".gridImages"))}else{if(P.closest(".mfp-container").length){return}else{if(P.closest(".ui-dialog").length){return}else{if(P.is(".mfp-close")){return}else{if(P.is("a.remove")){return}else{K(null,null)}}}}}}}});x(document).on("click",".InputfieldImageEdit__close",function(P){K(x(this).parents(".gridImages"),null)});x(document).on("change",".InputfieldImage",function(){x(this).find(".InputfieldImageButtonCrop:not(.pw-modal-dblclick)").addClass("pw-modal-dblclick ui-state-disabled")}).on("click",".InputfieldImageButtonCrop.ui-state-disabled",function(R){var Q=x(this);var P=Q.closest(".gridImages");if(!P.hasClass("gridImagesAlerted")){ProcessWire.alert(ProcessWire.config.InputfieldImage.labels.changes);P.addClass("gridImagesAlerted")}setTimeout(function(){Q.removeClass("ui-state-active")},500);return false});x(".ImagesGrid").on("click","button.pw-modal",function(P){P.preventDefault()});r();y()}function r(){x(document).on("click",".InputfieldImageEdit__name",function(R){var P=x(this).children("span");var S=P.closest(".gridImage, .InputfieldImageEdit").find(".InputfieldFileRename");var Q=P.closest(".gridImages");Q.sortable("disable");S.val(P.text());P.on("keypress",function(T){if(T.which==13){P.blur();return false}return true});P.attr("autocomplete","off").attr("autocorrect","off").attr("autocapitalize","off").attr("spellcheck","false");P.focus().on("blur",function(){var T=x(this).text();if(x.trim(T).length<1){P.text(S.val())}else{if(T!=S.val()){S.val(T).change();Q.closest(".Inputfield").trigger("change")}}P.off("keypress");Q.sortable("enable")})})}function m(P,Q){Q=Math.floor(Q);P.find(".gridImage__overflow").each(function(){var R=100-Q;var S=x(this);S.css("width",Q+"%");S.siblings(".ImageData").css("width",R+"%");S.find("img").css({top:0,left:0,transform:"none"})});f(P,"listSize",Q)}function k(T,P,R){if(!P){return}var Q=P+"px";var S=T.find(".gridImages");if(typeof R=="undefined"||R==null){R=S.attr("data-ragged")?true:false}if(R){S.attr("data-ragged",1)}else{S.removeAttr("data-ragged")}S.find(".gridImage__overflow").each(function(){i(x(this),P,R)});S.find(".gridImage__edit, .gridImage__resize").css("line-height",Q);S.attr("data-size",P);f(T,"size",P);if(s.length){setTimeout(function(){while(s.length){var U=s.pop();i(U,P,R)}},150)}}function i(Q,V,U,aa){if(Q.hasClass("gridImage__overflow")){var T=Q.children("img")}else{if(Q.is("img")){var T=Q;Q=T.closest(".gridImage__overflow")}else{return}}if(!V){T.removeAttr("width").removeAttr("height");Q.width("auto").height("auto");return}var P=0;var W=T.width();var ae=T.height();var X=parseInt(T.attr("data-w"));var af=parseInt(T.attr("data-h"));if(!W){W=X}if(!ae){ae=af}if(!U&&typeof aa=="undefined"){var ab=T.attr("data-focus");if(typeof ab=="undefined"){ab="50.0 50.0 0"}var ad=ab.split(" ");aa={top:parseFloat(ad[0]),left:parseFloat(ad[1]),zoom:parseInt(ad[2])}}if(!U){P=aa.zoom}if(U){T.attr("height",V).removeAttr("width");T.css({"max-height":"100%","max-width":"none",top:"50%",left:"50%",transform:"translate3d(-50%, -50%, 0)"})}else{if(P>0&&Q.closest(".InputfieldImageFocusZoom").length){if(W>=ae){var ac="100%";var ag="none"}else{var ac="none";var ag="100%"}var ah=1+((P/100)*2);var Z=aa.top;var S=aa.left;if(Z>92||Z>100){Z=100}if(S>92||S>100){S=100}if(Z<0){Z=0}if(S<0){S=0}var R=b(S,Z,P,W,ae,V,V);T.css({top:Z+"%",left:S+"%","transform-origin":"top left",transform:"scale("+ah+") translate3d(-"+S+"%, -"+Z+"%, 0)","max-width":ag,"max-height":ac})}else{if(W>=ae){T.attr("height",V).removeAttr("width");if(aa.left<1){aa.left=0.001}T.css({"max-height":"100%","max-width":"none",top:"50%",left:aa.left+"%",transform:"translate3d(-"+aa.left+"%, -50%, 0)"})}else{if(ae>W){T.attr("width",V).removeAttr("height");if(aa.top<1){aa.top=0.001}T.css({"max-height":"none","max-width":"100%",top:aa.top+"%",left:"50%",transform:"translate3d(-50%, -"+aa.top+"%, 0)"})}else{T.css({"max-height":"100%","max-width":"none",top:"50%",left:"50%",transform:"translate3d(-50%, -50%, 0)"});T.removeAttr("width").attr("height",V)}}}}var W=T.width();if(W){Q.css({width:(U?W+"px":V+"px"),height:V+"px"})}else{var Y=Q.attr("data-tries");if(!Y){Y=0}if(typeof Y=="undefined"){Y=0}Y=parseInt(Y);if(Y>3){Q.css({width:V+"px",height:V+"px"})}else{s.push(Q);Q.attr("data-tries",Y+1)}}}function E(Q){if(Q.find(".InputfieldImageListToggle").length){return}var T=x("<a class='InputfieldImageListToggle' href='list'></a>").append("<i class='fa fa-th-list'></i>");var V=x("<a class='InputfieldImageListToggle' href='left'></a>").append("<i class='fa fa-tasks'></i>");var P=x("<a class='InputfieldImageListToggle' href='grid'></a>").append("<i class='fa fa-th'></i>");var U="InputfieldImageListToggle--active";var S="";var R=function(ab){var aa=x(this);var Y=aa.closest(".Inputfield");var W=aa.attr("href");var X;var ac=aa.parent().children("."+U);var Z=ac.attr("href");ac.removeClass(U);aa.addClass(U);D(Y);if(W=="list"){if(!Y.hasClass("InputfieldImageEditAll")){Y.find(".InputfieldImageEdit--active .InputfieldImageEdit__close").click();Y.addClass("InputfieldImageEditAll")}X=I(Y,"listSize");m(Y,X);f(Y,"mode","list")}else{if(W=="left"){Y.removeClass("InputfieldImageEditAll");X=I(Y,"size");k(Y,X,true);f(Y,"mode","left");N()}else{if(W=="grid"){Y.removeClass("InputfieldImageEditAll");X=I(Y,"size");k(Y,X,false);f(Y,"mode","grid");if(Z=="left"){setTimeout(function(){k(Y,X,false)},100)}}}}F(Y.find(".gridImages"));aa.blur();return false};T.click(R);V.click(R);P.click(R);if(Q.hasClass("InputfieldImage")){Q.find(".InputfieldHeader").append(T).append(V).append(P);S=I(Q,"mode")}else{x(".InputfieldImage .InputfieldHeader",Q).append(T).append(V).append(P)}if(S=="list"){T.click()}else{if(S=="left"){V.click()}else{}}}function C(U){var R=U.children(".InputfieldHeader");if(R.children(".InputfieldImageSizeSlider").length){return}var T=U.find(".gridImages");var Q=T.attr("data-gridsize");var S=Q/2;var P=Q*2;var V=x('<span class="InputfieldImageSizeSlider"></span>');R.append(V);V.slider({min:S,max:P,value:I(U,"size"),range:"min",slide:function(Y,aa){var Z=aa.value;var ab=15;var ac=Math.floor(Q/ab);var W=Z-S;var X=Math.floor(ab+(W/ac));if(U.hasClass("InputfieldImageEditAll")){f(U,"size",Z);m(U,X)}else{f(U,"listSize",X);k(U,Z)}},start:function(W,X){if(U.find(".InputfieldImageEdit:visible").length){U.find(".InputfieldImageEdit__close").click()}},stop:function(W,X){N(U)}})}function f(Q,T,S){var R=I(Q);var U=Q.attr("id");var P=U?U.replace("wrap_Inputfield_",""):"";if(!P.length||typeof S=="undefined"){return}if(R[P][T]==S){return}R[P][T]=S;x.cookie("InputfieldImage",R);d=R}function I(Q,T){if(d&&typeof T=="undefined"){return d}var U=Q.attr("id");var P=U?U.replace("wrap_Inputfield_",""):"na";var S=d?d:x.cookie("InputfieldImage");var R=null;if(!S){var S={}}if(typeof S[P]=="undefined"){S[P]={}}if(typeof S[P].size=="undefined"){S[P].size=parseInt(Q.find(".gridImages").attr("data-size"))}if(typeof S[P].listSize=="undefined"){S[P].listSize=23}if(typeof S[P].mode=="undefined"){S[P].mode=Q.find(".gridImages").attr("data-gridMode")}if(d==null){d=S}if(typeof T=="undefined"){R=S}else{if(T===true){R=S[P]}else{if(typeof S[P][T]!="undefined"){R=S[P][T]}}}return R}function a(T){if(T.hasClass("InputfieldStateCollapsed")){return}var U=parseInt(T.find(".InputfieldImageMaxFiles").val());var S=T.find(".gridImages");var R=I(T,"size");var V=I(T,"mode");var Q=V=="left"?true:false;if(!R){R=S.attr("data-gridsize")}R=parseInt(R);if(T.hasClass("InputfieldImageEditAll")||V=="list"){var P=I(T,"listSize");m(T,P)}else{k(T,R,Q)}if(!T.hasClass("InputfieldImageInit")){T.addClass("InputfieldImageInit");if(T.hasClass("InputfieldRenderValueMode")){return q(T)}else{if(U==1){T.addClass("InputfieldImageMax1");v(T)}else{F(S)}}E(T);C(T)}y(T);T.on("change",".InputfieldFileActionSelect",function(){var W=x(this).next(".InputfieldFileActionNote");if(x(this).val().length){W.fadeIn()}else{W.hide()}})}function M(){x("body").addClass("ie-no-drop");x(".InputfieldImage.InputfieldFileMultiple").each(function(){var Q=x(this),S=parseInt(Q.find(".InputfieldFileMaxFiles").val()),P=Q.find(".gridImages"),R=Q.find(".InputfieldImageUpload");R.on("change","input[type=file]",function(){var W=x(this),U=W.parent(".InputMask");if(W.val().length>1){U.addClass("ui-state-disabled")}else{U.removeClass("ui-state-disabled")}if(W.next("input.InputfieldFile").length>0){return}var T=P.children("li").length+R.find("input[type=file]").length+1;if(S>0&&T>=S){return}R.find(".InputMask").not(":last").each(function(){var X=x(this);if(X.find("input[type=file]").val()<1){X.remove()}});var V=U.clone().removeClass("ui-state-disabled");V.children("input[type=file]").val("");V.insertAfter(U)})})}function O(R){var Q;if(R.length>0){Q=R.find(".InputfieldImageUpload")}else{Q=x(".InputfieldImageUpload")}Q.each(function(U){var V=x(this);var T=V.closest(".InputfieldContent");if(V.hasClass("InputfieldImageInitUpload")){return}S(T,U);V.addClass("InputfieldImageInitUpload")});function S(ac,ao){var ab=ac.parents("form");var T=ac.closest(".InputfieldRepeaterItem");var X=T.length?T.attr("data-editUrl"):ab.attr("action");X+=(X.indexOf("?")>-1?"&":"?")+"InputfieldFileAjax=1";var au=ab.find("input._post_token");var aa=au.attr("name");var af=au.val();var ae=ac.find(".InputfieldImageErrors").first();var W=ac.find(".InputfieldImageUpload").data("fieldname");W=W.slice(0,-2);var am=ac.closest(".Inputfield.InputfieldImage");var at=ac.find(".InputfieldImageUpload").data("extensions").toLowerCase();var al=ac.find(".InputfieldImageUpload").data("maxfilesize");var ad=ac.find("input[type=file]").get(0);var V=ac.find(".gridImages");var ap=V.get(0);var ah=V.data("gridsize");var ai=null;var ag=parseInt(ac.find(".InputfieldImageMaxFiles").val());var ar=o(am);var an=ar.maxWidth>0||ar.maxHeight>0||ar.maxSize>0;aq(ac);if(ag!=1){ak(V)}V.children().addClass("InputfieldFileItemExisting");am.on("pwimageupload",function(av,aw){aj([aw.file],aw.xhr)});function Z(aw,av){if(typeof av!=="undefined"){aw="<b>"+av+":</b> "+aw}return"<li>"+aw+"</li>"}function U(aw){var av=new String(aw).substring(aw.lastIndexOf("/")+1);if(av.lastIndexOf(".")!=-1){av=av.substring(0,av.lastIndexOf("."))}return av}function aq(aw){if(aw.hasClass("InputfieldImageDropzoneInit")){return}var az=aw.get(0);var ay=aw.closest(".Inputfield");function av(){if(ay.hasClass("pw-drag-in-file")){return}aw.addClass("ui-state-hover");ay.addClass("pw-drag-in-file")}function ax(){if(!ay.hasClass("pw-drag-in-file")){return}aw.removeClass("ui-state-hover");ay.removeClass("pw-drag-in-file")}az.addEventListener("dragleave",function(){ax()},false);az.addEventListener("dragenter",function(aA){aA.preventDefault();av()},false);az.addEventListener("dragover",function(aA){if(!aw.is("ui-state-hover")){av()}aA.preventDefault();aA.stopPropagation();return false},false);az.addEventListener("drop",function(aA){aj(aA.dataTransfer.files);ax();aA.preventDefault();aA.stopPropagation();return false},false);aw.addClass("InputfieldImageDropzoneInit")}function ak(aD){var aH=null;var aF=false;var aw=null;var av=aD.closest(".Inputfield");function aA(){av.addClass("pw-drag-in-file")}function aG(){av.removeClass("pw-drag-in-file")}function az(aJ){var aN=aJ.offset();var aK=aJ.width();var aI=aJ.height();var aM=aN.left+aK/2;var aL=aN.top+aI/2;return{clientX:aM,clientY:aL}}function aC(){return aD.find(".InputfieldImageEdit--active").length>0}function aB(aJ){if(aC()){return}aJ.preventDefault();aJ.stopPropagation();aA();aF=false;if(aH==null){var aI=aD.attr("data-size")+"px";var aK=x("<div/>").addClass("gridImage__overflow");if(aD.closest(".InputfieldImageEditAll").length){aK.css({width:"100%",height:aI})}else{aK.css({width:aI,height:aI})}aH=x("<li/>").addClass("ImageOuter gridImage gridImagePlaceholder").append(aK);aD.append(aH)}var aL=az(aH);aH.simulate("mousedown",aL)}function aE(aI){if(aC()){return}aI.preventDefault();aI.stopPropagation();aA();aF=false;if(aH==null){return}var aJ={clientX:aI.originalEvent.clientX,clientY:aI.originalEvent.clientY};aH.simulate("mousemove",aJ)}function ay(aI){if(aC()){return}aI.preventDefault();aI.stopPropagation();if(aH==null){return false}aF=true;if(aw){clearTimeout(aw)}aw=setTimeout(function(){if(!aF||aH==null){return}aH.remove();aH=null;aG()},1000)}function ax(aI){if(aC()){return}aG();aF=false;var aJ={clientX:aI.clientX,clientY:aI.clientY};aH.simulate("mouseup",aJ);l=aH.next(".gridImage");aH.remove();aH=null}if(aD.length&&!aD.hasClass("gridImagesInitDropInPlace")){aD.on("dragenter",aB);aD.on("dragover",aE);aD.on("dragleave",ay);aD.on("drop",ax);aD.addClass("gridImagesInitDropInPlace")}}function Y(aU,aI,aE){var aR=ProcessWire.config.InputfieldImage.labels;var aB=parseInt(aU.size/1024,10)+"&nbsp;kB";var aT='<div class="gridImage__tooltip"><table><tbody><tr><th>'+aR.dimensions+'</th><td class="dimensions">'+aR.na+"</td></tr><tr><th>"+aR.filesize+"</th><td>"+aB+"</td></tr><tr><th>"+aR.variations+"</th><td>0</td></tr></tbody></table></div>";var aW=x('<li class="gridImage gridImageUploading"></li>'),aO=x(aT),aC=x('<div class="gridImage__overflow"></div>'),av=x('<div class="ImageData"></div>'),aL=x("<div class='gridImage__hover'><div class='gridImage__inner'></div></div>"),aN=x("<progress class='gridImage__progress' min='-1' max='100' value='0'></progress>"),aQ=x('<a class="gridImage__edit" title="'+aU.name+'"><span>&nbsp;</span></a>'),aP=x('<div class="gridImage__resize"><i class="fa fa-spinner fa-spin fa-2x fa-fw"></i></div>'),aw,aG,aV,aJ=URL.createObjectURL(aU),ax=am.find(".gridImages"),az=ag==1,aM=I(am,"size"),aA=I(am,"listSize"),ay=am.hasClass("InputfieldImageEditAll"),aF=x('<img height="'+aM+'" alt="">');aC.append(aF);aL.find(".gridImage__inner").append(aQ);aL.find(".gridImage__inner").append(aP.css("display","none"));aL.find(".gridImage__inner").append(aN);av.append(x('<h2 class="InputfieldImageEdit__name">'+aU.name+'</h2><span class="InputfieldImageEdit__info">'+aB+"</span>"));if(ay){aC.css("width",aA+"%");av.css("width",(100-aA)+"%")}else{aC.css({width:aM+"px",height:aM+"px"})}aW.append(aO).append(aC).append(aL).append(av);aF.attr({src:aJ,"data-original":aJ});img=new Image();img.addEventListener("load",function(){aO.find(".dimensions").html(this.width+"&nbsp;&times;&nbsp;"+this.height);var aX=Math.min(this.width,this.height)/aM;aF.attr({width:this.width/aX,height:this.height/aX})},false);img.src=aJ;if(typeof aE!="undefined"){aG=aE}else{aG=new XMLHttpRequest()}function aH(aX){if(typeof aX!="undefined"){if(!aX.lengthComputable){return}aN.attr("value",parseInt((aX.loaded/aX.total)*100))}x("body").addClass("pw-uploading");aP.css("display","block")}aG.upload.addEventListener("progress",aH,false);aG.addEventListener("load",function(){aG.getAllResponseHeaders();var a0=x.parseJSON(aG.responseText);if(typeof a0.ajaxResponse!="undefined"){a0=a0.ajaxResponse}var aY=a0.length>1;if(a0.error!==undefined){a0=[a0]}for(var aZ=0;aZ<a0.length;aZ++){var aX=a0[aZ];if(aX.error){ae.append(Z(aX.message));continue}var a6=null;var a2=x(aX.markup).hide();var a5=ac.find("input[type=file]");if(a5.val()){a5.replaceWith(a5.clone(true))}if(aX.overwrite){a6=ax.children("#"+a2.attr("id"))}if(ag==1||aX.replace){a6=ax.children(".gridImage:eq(0)")}else{if(c.item&&a0.length==1){a6=c.item}}if(a6&&a6.length){a6.replaceWith(a2)}else{if(l&&l.length){l.before(a2);l=a2}else{if(aZ===0){aW.replaceWith(a2)}else{ax.append(a2)}}}if(ay){a2.find(".gridImage__overflow").css("width",aA+"%")}else{a2.find(".gridImage__overflow").css({height:aM+"px",width:aM+"px"});a2.find("img").hide()}a2.fadeIn(150,function(){a2.find("img").fadeIn();if(ay){m(am,aA)}else{k(am,aM)}}).css("display","");a2.addClass("InputfieldFileItemExisting");if(a6&&a6.length){a2.effect("highlight",500)}if(aW.length){aW.remove()}if(c.item&&ag!=1){a2.find(".InputfieldFileReplace").val(c.file);var a8=a2.find(".InputfieldImageEdit__name");var a4=a8.text();var a7=a4.substring(a4.lastIndexOf(".")+1).toLowerCase();a4=a4.substring(0,a4.lastIndexOf("."));var a3=c.file;if(a3.indexOf("?")>-1){a3=a3.substring(0,a3.indexOf("?"))}var a1=a3.substring(a3.lastIndexOf(".")+1).toLowerCase();a3=a3.substring(0,a3.lastIndexOf("."));if(a1==a7){a8.children("span").text(a3).removeAttr("contenteditable")}a2.find(".gridImage__edit").click()}c.file="";c.item=null;c.edit=null}if(ai){clearTimeout(ai)}l=null;ai=setTimeout(function(){if(ag!=1){F(ax)}else{v(am)}x("body").removeClass("pw-uploading");ax.trigger("AjaxUploadDone")},500);am.trigger("change").removeClass("InputfieldFileEmpty")},false);if(c.edit){c.edit.find(".InputfieldImageEdit__close").click()}else{if(am.find(".InputfieldImageEdit:visible").length){am.find(".InputfieldImageEdit__close").click()}}if(c.item){c.item.replaceWith(aW);c.item=aW}else{if(l&&l.length){l.before(aW)}else{ax.append(aW)}}function aS(aX,aZ){if(typeof aE=="undefined"){aG.open("POST",X,true)}aG.setRequestHeader("X-FILENAME",encodeURIComponent(aX.name));aG.setRequestHeader("X-FIELDNAME",W);if(c.item){aG.setRequestHeader("X-REPLACENAME",c.file)}aG.setRequestHeader("Content-Type","application/octet-stream");aG.setRequestHeader("X-"+aa,af);aG.setRequestHeader("X-REQUESTED-WITH","XMLHttpRequest");if(typeof aZ!="undefined"&&aZ!=false){aG.send(aZ)}else{aG.send(aX)}N();am.trigger("change");var aY=am.find(".InputfieldFileItem").length;if(aY==1){am.removeClass("InputfieldFileEmpty").removeClass("InputfieldFileMultiple").addClass("InputfieldFileSingle")}else{if(aY>1){am.removeClass("InputfieldFileEmpty").removeClass("InputfieldFileSingle").addClass("InputfieldFileMultiple")}}}aH();var aD=aU.name.substring(aU.name.lastIndexOf(".")+1).toLowerCase();if(an&&(aD=="jpg"||aD=="jpeg"||aD=="png"||aD=="gif")){var aK=new PWImageResizer(ar);aP.addClass("pw-resizing");aK.resize(aU,function(aX){aP.removeClass("pw-resizing");aS(aU,aX)})}else{aS(aU)}}function aj(av,aC){var aA=function(aE){return parseInt(aE/1024,10)};if(typeof av==="undefined"){ap.innerHTML="No support for the File API in this web browser";return}for(var ay=0,ax=av.length;ay<ax;ay++){var aB=av[ay].name.split(".").pop().toLowerCase();var aD;if(at.indexOf(aB)==-1){aD=aB+" is a invalid file extension, please use one of:  "+at;ae.append(Z(aD,av[ay].name))}else{if(!an&&av[ay].size>al&&al>2000000){var aw=aA(av[ay].size),az=aA(al);aD="Filesize "+aw+" kb is too big. Maximum allowed is "+az+" kb";ae.append(Z(aD,av[ay].name))}else{if(typeof aC!="undefined"){Y(av[ay],aB,aC)}else{Y(av[ay],aB)}}}if(ag==1){break}}}ad.addEventListener("change",function(av){aj(this.files);av.preventDefault();av.stopPropagation();this.value=""},false)}function P(){var T=".InputfieldImageEdit__imagewrapper img";x(document).on("dragenter",T,function(){var W=x(this);if(W.closest(".InputfieldImageMax1").length){return}var X=W.attr("src");var U=W.closest(".InputfieldImageEdit");var V=W.closest(".InputfieldImageEdit__imagewrapper");V.addClass("InputfieldImageEdit__replace");c.file=new String(X).substring(X.lastIndexOf("/")+1);c.item=x("#"+U.attr("data-for"));c.edit=U}).on("dragleave",T,function(){var V=x(this);if(V.closest(".InputfieldImageMax1").length){return}var U=V.closest(".InputfieldImageEdit__imagewrapper");U.removeClass("InputfieldImageEdit__replace");c.file="";c.item=null;c.edit=null})}P()}function o(Q){var P={maxWidth:0,maxHeight:0,maxSize:0,quality:1,autoRotate:true,debug:ProcessWire.config.debug};var R=Q.attr("data-resize");if(typeof R!="undefined"&&R.length){R=R.split(";");P.maxWidth=parseInt(R[0]);P.maxHeight=parseInt(R[1]);P.maxSize=parseFloat(R[2]);P.quality=parseFloat(R[3])}return P}function L(){x(".InputfieldImage.Inputfield").each(function(){a(x(this))});A();if(u()){O("")}else{M()}x(document).on("reloaded",".InputfieldImage",function(){var P=x(this);a(P);O(P)}).on("wiretabclick",function(R,Q,P){Q.find(".InputfieldImage").each(function(){a(x(this))})}).on("opened",".InputfieldImage",function(){a(x(this))})}L()}jQuery(document).ready(function(a){InputfieldImage(a)});